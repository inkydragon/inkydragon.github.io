<!DOCTYPE html>
<html lang="zh-cn">
  <head><meta name="generator" content="Hexo 3.8.0">
    
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">


<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">



  <meta name="description" content="尝试在 Win 10 上编译安装带 GPU 支持的 TensorFlow">







  <link rel="alternate" href="/atom.xml" title="0u0' lab | Hexo">




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=2.4.x">



<link rel="canonical" href="https://blog.wo-class.cn/Win-10-下编译带-GPU-支持的-Tensorflow/">


<meta name="description" content="尝试在 Win 10 上编译安装带 GPU 支持的 TensorFlow">
<meta property="og:type" content="article">
<meta property="og:title" content="Win 10 下编译带 GPU 支持的 Tensorflow">
<meta property="og:url" content="https://blog.wo-class.cn/Win-10-下编译带-GPU-支持的-Tensorflow/index.html">
<meta property="og:site_name" content="0u0&#39; lab | Hexo">
<meta property="og:description" content="尝试在 Win 10 上编译安装带 GPU 支持的 TensorFlow">
<meta property="og:locale" content="zh-cn">
<meta property="og:image" content="https://blog.wo-class.cn/Win-10-下编译带-GPU-支持的-Tensorflow/Win-10-下编译带-GPU-支持的-Tensorflow/vc_redist.x64-error.png">
<meta property="og:updated_time" content="2018-12-22T16:17:50.612Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Win 10 下编译带 GPU 支持的 Tensorflow">
<meta name="twitter:description" content="尝试在 Win 10 上编译安装带 GPU 支持的 TensorFlow">
<meta name="twitter:image" content="https://blog.wo-class.cn/Win-10-下编译带-GPU-支持的-Tensorflow/Win-10-下编译带-GPU-支持的-Tensorflow/vc_redist.x64-error.png">


<link rel="stylesheet" type="text/css" href="/css/style.css?v=2.4.x">



  <link rel="stylesheet" type="text/css" href="/lib/fancybox/jquery.fancybox.css">





<script>
  var CONFIG = {
    search: true,
    searchPath: "/search.xml",
    fancybox: true,
    toc: true,
  }
</script>





    <title> Win 10 下编译带 GPU 支持的 Tensorflow · 0u0' lab | Hexo </title>
  </head>

  <body><div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/." class="logo">0u0' lab | Hexo</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>

<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    
      <a href="/">
        <li class="mobile-menu-item">
          
          
            Home
          
        </li>
      </a>
    
      <a href="/archives/">
        <li class="mobile-menu-item">
          
          
            Archives
          
        </li>
      </a>
    
      <a href="/tags">
        <li class="mobile-menu-item">
          
          
            Tags
          
        </li>
      </a>
    
      <a href="/categories">
        <li class="mobile-menu-item">
          
          
            Categories
          
        </li>
      </a>
    
  </ul>
</nav>

    <div class="container" id="mobile-panel">
      <header id="header" class="header"><div class="logo-wrapper">
  <a href="/." class="logo">0u0' lab | Hexo</a>
</div>

<nav class="site-navbar">
  
    <ul id="menu" class="menu">
      
        <li class="menu-item">
          <a class="menu-item-link" href="/">
            
            
              首页
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/archives/">
            
            
              归档
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/tags">
            
            
              标签
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/categories">
            
            
              分类
            
          </a>
        </li>
      
      
        <li class="menu-search">
          <form>
            <i class="iconfont icon-search" id="open-search"></i>
            <input type="text" class="search-input" id="search-input">
            <i class="iconfont icon-close" id="close-search"></i>
          </form>
        </li>
      
    </ul>
  
</nav>

      </header>

      <main id="main" class="main">
        <div class="content-wrapper">
          <div id="content" class="content">
            
  
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          Win 10 下编译带 GPU 支持的 Tensorflow
        
      </h1>

      <div class="post-meta">
        <span class="post-time">
          2018年12月22日
        </span>
      </div>
    </header>

    
    
  <div class="post-toc" id="post-toc">
    <h2 class="post-toc-title">文章目录</h2>
    <div class="post-toc-content">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#在-Windows-上从源码编译安装"><span class="toc-text">在 Windows 上从源码编译安装</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Windows-上的准备工作"><span class="toc-text">Windows 上的准备工作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#安装-Python-和-TensorFlow-的相关依赖"><span class="toc-text">安装 Python 和 TensorFlow 的相关依赖</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#安装-Bazel"><span class="toc-text">安装 Bazel</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#安装-MSYS2"><span class="toc-text">安装 MSYS2</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#安装-Visual-C-Build-Tools-2015"><span class="toc-text">安装 Visual C++ Build Tools 2015</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#安装-GPU-支持-可选的"><span class="toc-text">安装 GPU 支持 (可选的)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#下载-TensorFlow-的源码"><span class="toc-text">下载 TensorFlow 的源码</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#构建配置"><span class="toc-text">构建配置</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#带-GPU-支持"><span class="toc-text">带 GPU 支持</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Bazel-构建选项"><span class="toc-text">Bazel 构建选项</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#构建包"><span class="toc-text">构建包</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#安装包"><span class="toc-text">安装包</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#使用-MSYS-shell-构建包"><span class="toc-text">使用 MSYS shell 构建包</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Disable-MSYS-path-conversion-hide-from-toc"><span class="toc-text">Disable MSYS path conversion {:.hide-from-toc}</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Set-your-PATH-hide-from-toc"><span class="toc-text">Set your PATH {:.hide-from-toc}</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#经过测试的构建配置"><span class="toc-text">经过测试的构建配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#CPU"><span class="toc-text">CPU</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GPU"><span class="toc-text">GPU</span></a></li></ol></li></ol>
    </div>
  </div>


    <div class="post-content">
      
        <a id="more"></a>
<p><strong>【官方文档-begin】</strong></p>
<ul>
<li><a href="https://www.tensorflow.org/install/source_windows" target="_blank" rel="noopener">Build from source on Windows  |  TensorFlow@tensorflow.org</a></li>
<li><a href="https://tensorflow.google.cn/install/source_windows" target="_blank" rel="noopener">Build from source on Windows  |  TensorFlow#tensorflow.google.cn</a></li>
</ul>
<p>以下为官方文档的部分翻译（用引用标出）<br>以及一些问题的记录。</p>
<hr>
<!-- # Build from source on Windows -->
<h1 id="在-Windows-上从源码编译安装"><a href="#在-Windows-上从源码编译安装" class="headerlink" title="在 Windows 上从源码编译安装"></a>在 Windows 上从源码编译安装</h1><!-- 
Build a TensorFlow *pip* package from source and install it on Windows.

Note: We already provide well-tested, pre-built [TensorFlow packages](./pip.md)
for Windows systems. 
-->
<blockquote>
<p>在 windows 上，从源码构建出一个 TensorFlow 的 <em>pip</em> 包，并安装。</p>
<p>注意！我们已经为 windows 系统提供了经过良好测试的、预构建的 <a href="./pip.md">TensorFlow 包</a></p>
</blockquote>
<!-- ## Setup for Windows -->
<h2 id="Windows-上的准备工作"><a href="#Windows-上的准备工作" class="headerlink" title="Windows 上的准备工作"></a>Windows 上的准备工作</h2><!-- Install the following build tools to configure your Windows development
environment. -->
<blockquote>
<p>安装以下构建工具，配置好你的 Windows 开发环境。</p>
</blockquote>
<!-- ### Install Python and the TensorFlow package dependencies -->
<h3 id="安装-Python-和-TensorFlow-的相关依赖"><a href="#安装-Python-和-TensorFlow-的相关依赖" class="headerlink" title="安装 Python 和 TensorFlow 的相关依赖"></a>安装 Python 和 TensorFlow 的相关依赖</h3><p>Python <strong>安装包</strong>国内镜像：</p>
<ul>
<li><a href="https://npm.taobao.org/mirrors/python/3.6.8/" target="_blank" rel="noopener">3.6.8 - taobao Python Mirror</a></li>
<li><a href="https://npm.taobao.org/mirrors/python/3.5.4/" target="_blank" rel="noopener">3.5.4 - taobao Python Mirror</a></li>
<li><a href="https://npm.taobao.org/mirrors/python" target="_blank" rel="noopener">所有版本 - taobao Python Mirror</a></li>
</ul>
<p>注意！Python 的<strong>镜像源</strong>建议用 tuna <a href="https://mirrors.tuna.tsinghua.edu.cn/help/pypi/" target="_blank" rel="noopener">Pypi | 镜像站使用帮助 | 清华大学开源软件镜像站 | Tsinghua Open Source Mirror</a></p>
<!-- 
Install a
[Python 3.5.x or Python 3.6.x 64-bit release for Windows](https://www.python.org/downloads/windows/).
Select *pip* as an optional feature and add it to your `%PATH%` environmental variable.

Install the TensorFlow *pip* package dependencies: 
-->
<blockquote>
<p>安装为 windows 准备的 64 位的 <a href="https://www.python.org/downloads/windows/" target="_blank" rel="noopener">Python 3.5.x 或 Python 3.6.x 64-bit 发行版</a><br>安装的时候同时选上 安装 <em>pip</em>，并把它添加到你的环境变量里。</p>
<p>用 <em>pip</em> 安装 TensorFlow 的 python 依赖：</p>
</blockquote>
<!-- 
<pre class="devsite-click-to-copy">
<code class="devsite-terminal tfo-terminal-windows">pip3 install six numpy wheel</code>
<code class="devsite-terminal tfo-terminal-windows">pip3 install keras_applications==1.0.5 --no-deps</code>
<code class="devsite-terminal tfo-terminal-windows">pip3 install keras_preprocessing==1.0.3 --no-deps</code>
</pre> 
-->
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pip3 install six numpy wheel</span><br><span class="line">pip3 install keras_applications==<span class="number">1.0</span><span class="number">.6</span> --no-deps</span><br><span class="line">pip3 install keras_preprocessing==<span class="number">1.0</span><span class="number">.5</span> --no-deps</span><br></pre></td></tr></table></figure>
<!-- The dependencies are listed in the
[`setup.py`](https://github.com/tensorflow/tensorflow/blob/master/tensorflow/tools/pip_package/setup.py)
file under `REQUIRED_PACKAGES`. -->
<blockquote>
<p>更详细的依赖列出于 <a href="https://github.com/tensorflow/tensorflow/blob/master/tensorflow/tools/pip_package/setup.py" target="_blank" rel="noopener"><code>setup.py</code></a> 文件的 <code>REQUIRED_PACKAGES</code> 数组及其下方。</p>
</blockquote>
<p>截取的完整依赖：<br>用不上的依赖已被注释掉，无关的语句已省略。</p>
<figure class="highlight python"><figcaption><span>dependencies</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">_VERSION = <span class="string">'1.12.0'</span></span><br><span class="line"></span><br><span class="line">REQUIRED_PACKAGES = [</span><br><span class="line">    <span class="string">'absl-py &gt;= 0.1.6'</span>,</span><br><span class="line">    <span class="string">'astor &gt;= 0.6.0'</span>,</span><br><span class="line">    <span class="string">'gast &gt;= 0.2.0'</span>,</span><br><span class="line">    <span class="string">'keras_applications &gt;= 1.0.6'</span>,</span><br><span class="line">    <span class="string">'keras_preprocessing &gt;= 1.0.5'</span>,</span><br><span class="line">    <span class="string">'numpy &gt;= 1.13.3'</span>,</span><br><span class="line">    <span class="string">'six &gt;= 1.10.0'</span>,</span><br><span class="line">    <span class="string">'protobuf &gt;= 3.6.1'</span>,</span><br><span class="line">    <span class="string">'tensorboard &gt;= 1.12.0, &lt; 1.13.0'</span>,</span><br><span class="line">    <span class="string">'tensorflow_estimator &gt;= 1.10.0'</span>,</span><br><span class="line">    <span class="string">'termcolor &gt;= 1.1.0'</span>,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment"># windows 需要装这个</span></span><br><span class="line"><span class="keyword">if</span> sys.byteorder == <span class="string">'little'</span>:</span><br><span class="line">  <span class="comment"># grpcio does not build correctly on big-endian machines due to lack of</span></span><br><span class="line">  <span class="comment"># BoringSSL support.</span></span><br><span class="line">  <span class="comment"># See https://github.com/tensorflow/tensorflow/issues/17882.</span></span><br><span class="line">  REQUIRED_PACKAGES.append(<span class="string">'grpcio &gt;= 1.8.6'</span>)</span><br><span class="line"></span><br><span class="line">....</span><br><span class="line"></span><br><span class="line"><span class="comment"># python3 requires wheel 0.26</span></span><br><span class="line"><span class="keyword">if</span> sys.version_info.major == <span class="number">3</span>:</span><br><span class="line">  REQUIRED_PACKAGES.append(<span class="string">'wheel &gt;= 0.26'</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">  REQUIRED_PACKAGES.append(<span class="string">'wheel'</span>)</span><br><span class="line">  <span class="comment"># mock comes with unittest.mock for python3, need to install for python2</span></span><br><span class="line">  REQUIRED_PACKAGES.append(<span class="string">'mock &gt;= 2.0.0'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># tf-nightly should depend on tb-nightly</span></span><br><span class="line"><span class="keyword">if</span> <span class="string">'tf_nightly'</span> <span class="keyword">in</span> project_name:</span><br><span class="line">  <span class="keyword">for</span> i, pkg <span class="keyword">in</span> enumerate(REQUIRED_PACKAGES):</span><br><span class="line">    <span class="keyword">if</span> <span class="string">'tensorboard'</span> <span class="keyword">in</span> pkg:</span><br><span class="line">      REQUIRED_PACKAGES[i] = <span class="string">'tb-nightly &gt;= 1.13.0a0, &lt; 1.14.0a0'</span></span><br><span class="line">    <span class="keyword">elif</span> <span class="string">'tensorflow_estimator'</span> <span class="keyword">in</span> pkg <span class="keyword">and</span> <span class="string">'2.0'</span> <span class="keyword">in</span> project_name:</span><br><span class="line">      REQUIRED_PACKAGES[i] = <span class="string">'tensorflow-estimator-2.0-preview'</span></span><br><span class="line">    <span class="keyword">elif</span> <span class="string">'tensorflow_estimator'</span> <span class="keyword">in</span> pkg:</span><br><span class="line">      REQUIRED_PACKAGES[i] = <span class="string">'tf-estimator-nightly'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 新一点的 tf 都是 py 3.5 以上的啦</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string"># weakref.finalize and enum were introduced in Python 3.4</span></span><br><span class="line"><span class="string">if sys.version_info &lt; (3, 4):</span></span><br><span class="line"><span class="string">  REQUIRED_PACKAGES.append('backports.weakref &gt;= 1.0rc1')</span></span><br><span class="line"><span class="string">  REQUIRED_PACKAGES.append('enum34 &gt;= 1.1.6')</span></span><br><span class="line"><span class="string">'''</span></span><br></pre></td></tr></table></figure>
<p>一般来说配置好 python 的镜像源之后装这些东西都没有问题。<br>所以我只执行了上面提到的三条语句。<br>不过为了以防万一，网不好什么的，我还是尽可能地下载了 python3.6 版的 <code>.whl</code> 包，以备急用。</p>
<p>完整 python3.6 依赖列表<br>absl-py<br>astor<br>gast<br>keras_applications<br>keras_preprocessing<br>numpy<br>six<br>protobuf<br>tensorboard<br>tensorflow_estimator<br>termcolor<br>grpcio<br>wheel<br>mock</p>
<p>一句话 pip 安装：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip3 install absl-py, astor, gast, keras_applications, keras_preprocessing, numpy, six, protobuf, tensorboard, tensorflow_estimator, termcolor, grpcio, wheel, mock</span><br></pre></td></tr></table></figure></p>
<p><strong>附无 wheel 版的 python 依赖</strong><br>即需要通过 pip 安装</p>
<ul>
<li><code>absl-py</code></li>
<li><code>gast</code></li>
<li><code>termcolor</code></li>
</ul>
<p><strong>需要注意 python 版本的包</strong><br>即 py3.5/3.6 安装的版本不同</p>
<ul>
<li><a href="https://pypi.org/project/numpy/#files" target="_blank" rel="noopener"><code>numpy</code> · PyPI</a></li>
<li><a href="https://pypi.org/project/protobuf/#files" target="_blank" rel="noopener"><code>protobuf</code> · PyPI</a></li>
<li><a href="https://pypi.org/project/grpcio/#files" target="_blank" rel="noopener"><code>grpcio</code> · PyPI</a></li>
</ul>
<p>找 <code>.whl</code> 包的网站</p>
<ul>
<li><a href="https://pythonwheels.com/" target="_blank" rel="noopener">Python Wheels</a><br>查看对 python 包对 wheel 的支持。（列表不全，需要到 PyPI 上进一步确认，也就是说，他这里没有不一定真没有。）</li>
<li><a href="https://pypi.org/" target="_blank" rel="noopener">PyPI – the Python Package Index · PyPI</a></li>
<li><a href="https://www.lfd.uci.edu/~gohlke/pythonlibs/" target="_blank" rel="noopener">Python Extension Packages for Windows - Christoph Gohlke</a></li>
<li><a href="https://mirrors.tuna.tsinghua.edu.cn/help/pypi/" target="_blank" rel="noopener">Pypi | 镜像站使用帮助 | 清华大学开源软件镜像站 | Tsinghua Open Source Mirror</a></li>
</ul>
<h3 id="安装-Bazel"><a href="#安装-Bazel" class="headerlink" title="安装 Bazel"></a>安装 Bazel</h3><!-- 
[Install Bazel](https://docs.bazel.build/versions/master/install-windows.html),
the build tool used to compile TensorFlow.

Add the location of the Bazel executable to your `%PATH%` environment variable. 
-->
<blockquote>
<p>安装用于编译 Tensorflow 的工具：<a href="https://docs.bazel.build/versions/master/install-windows.html" target="_blank" rel="noopener">Bazel</a>。</p>
<p>并把 Bazel 的可执行文件添加到你的 <code>%PATH%</code> 环境变量中去。</p>
</blockquote>
<p><strong>Bazel on Windows 依赖</strong></p>
<ul>
<li>64 bit Windows 7 or newer, or 64 bit Windows Server 2008 R2 or newer</li>
<li>MSYS2 shell<br>国内下载镜像，文件命名格式为 <code>msys2-&lt;架构&gt;-&lt;日期&gt;.exe</code> 选最新的。<ul>
<li><a href="https://mirrors.tuna.tsinghua.edu.cn/msys2/distrib/x86_64/" target="_blank" rel="noopener">msys2@x86_64 | 清华大学开源软件镜像站 | Tsinghua Open Source Mirror</a></li>
</ul>
</li>
<li><a href="https://www.microsoft.com/zh-CN/download/details.aspx?id=48145" target="_blank" rel="noopener">Download Visual C++ Redistributable for Visual Studio 2015 from Official Microsoft Download Center</a><br>These are common DLLs that Bazel needs. You may already have them installed.</li>
</ul>
<p>安装 <code>vc_redist.x64</code> 时可能报错<br><img src="./Win-10-下编译带-GPU-支持的-Tensorflow/vc_redist.x64-error.png" alt=""></p>
<p>看日志<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Error 0x80070666: Cannot install a product when a newer version is installed.</span><br></pre></td></tr></table></figure></p>
<p>应该是已经安装了更新的版本，那就继续，不用管他。</p>
<h3 id="安装-MSYS2"><a href="#安装-MSYS2" class="headerlink" title="安装 MSYS2"></a>安装 MSYS2</h3><p><strong>上面装 Bazel 的时候作为依赖之一，已经装过了</strong></p>
<p>这里可以设置国内的镜像源</p>
<ul>
<li><a href="https://mirrors.tuna.tsinghua.edu.cn/help/msys2/" target="_blank" rel="noopener">Msys2 | 镜像站使用帮助 | 清华大学开源软件镜像站 | Tsinghua Open Source Mirror</a></li>
</ul>
<!-- 
[Install MSYS2](https://www.msys2.org/) for the bin tools needed to
build TensorFlow. If MSYS2 is installed to `C:\msys64`, add
`C:\msys64\usr\bin` to your `%PATH%` environment variable. Then, using `cmd.exe`,
run: 
-->
<blockquote>
<p>安装 <a href="https://www.msys2.org/" target="_blank" rel="noopener">MSYS2</a>，准备好构建 Tensorflow 所需的各种工具。<br>如果你把 MSYS2 安装在 <code>C:\msys64</code> 下，请把 <code>C:\msys64\usr\bin</code> 添加到你的 <code>%PATH%</code> 环境变量中。<br>然后打开 <code>cmd.exe</code> 并执行：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; pacman -S git patch unzip</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<p>上面这句大概要下载 30M 的东西，该不该镜像源都行，改了基本秒下完。</p>
<h3 id="安装-Visual-C-Build-Tools-2015"><a href="#安装-Visual-C-Build-Tools-2015" class="headerlink" title="安装 Visual C++ Build Tools 2015"></a>安装 Visual C++ Build Tools 2015</h3><!-- 
Install the *Visual C++ build tools 2015*. This comes with *Visual Studio 2015*
but can be installed separately:

1. Go to the [Visual Studio downloads](https://visualstudio.microsoft.com/vs/older-downloads/){:.external},
2. Select *Redistributables and Build Tools*,
3. Download and install:
   - *Microsoft Visual C++ 2015 Redistributable Update 3*
   - *Microsoft Build Tools 2015 Update 3*

Note: TensorFlow is tested against the *Visual Studio 2015 Update 3*. 
-->
<blockquote>
<p>安装 <em>Visual C++ build tools 2015</em>，<em>Visual Studio 2015</em>自带这些构建工具，不过它们也可以单独安装。</p>
<ol>
<li>打开 - <a href="https://visualstudio.microsoft.com/zh-hans/vs/older-downloads/#redistributables-and-build-tools-zh-hans" target="_blank" rel="noopener">下载旧版 Visual Studio 软件 | Visual Studio - Visual Studio</a> </li>
<li>选择 <em>可再发行组件和生成工具</em>；</li>
<li>下载并安装：<ul>
<li><em>Microsoft Visual C++ 2015 Redistributable 更新 3</em></li>
<li><em>Microsoft 生成工具 2015 更新 3</em></li>
</ul>
</li>
</ol>
<p>注意！TensorFlow 在 <em>Visual Studio 2015 Update 3</em> 中进行了测试。</p>
</blockquote>
<h3 id="安装-GPU-支持-可选的"><a href="#安装-GPU-支持-可选的" class="headerlink" title="安装 GPU 支持 (可选的)"></a>安装 GPU 支持 (可选的)</h3><!-- See the Windows [GPU support](./gpu.md) guide to install the drivers and additional
software required to run TensorFlow on a GPU. -->
<blockquote>
<p>参见 Windows 上的 <a href="./gpu.md">GPU 支持</a>说明，安装在 GPU 上运行 TensorFlow 所需的驱动及其他附加软件。</p>
</blockquote>
<p>到这里下载老版的 CUDA Toolkit</p>
<ul>
<li><a href="https://developer.nvidia.com/cuda-toolkit-archive" target="_blank" rel="noopener">CUDA Toolkit Archive | NVIDIA Developer</a><br>1.5 G 的样子</li>
</ul>
<ol>
<li><p>别用 NVIDIA CUDA Profiling Tools Interface (<strong>CUPTI</strong>)  </p>
<blockquote>
<p>CUPTI 1.0 should be used along with the<strong> CUDA Toolkit 10.0</strong> production release</p>
</blockquote>
<p> 新版的 tf 1.12.0 才支持到 CUDA 9.0。</p>
</li>
<li><p>NCCL 2.2 需要多 GPU 支持才用去下。需要登陆UFF</p>
</li>
<li><p>TensorRT 4.0 不支持 win 上面的 Tensorflow，只支持 Caffe 和 UFF</p>
<blockquote>
<p>The Windows zip package for TensorRT does not provide Python support. Also, <strong>only the Caffe and UFF parsers are supported on Windows at this time</strong>. Python and the ONNX parser may be supported in the future.</p>
</blockquote>
<p> 另外通过 zip 安装它需要 CUDA Toolkit <strong>10.0</strong> 和 cuDNN 7.3.1。所以 Windows 上也别想了。</p>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SET PATH=C:\tools\cuda\bin;%PATH%</span><br></pre></td></tr></table></figure>
<!-- ### Download the TensorFlow source code -->
<h3 id="下载-TensorFlow-的源码"><a href="#下载-TensorFlow-的源码" class="headerlink" title="下载 TensorFlow 的源码"></a>下载 TensorFlow 的源码</h3><!-- 
Use [Git](https://git-scm.com/){:.external} to clone the
[TensorFlow repository](https://github.com/tensorflow/tensorflow){:.external}
(`git` is installed with MSYS2): 
-->
<blockquote>
<p>使用 <a href="https://git-scm.com/" target="_blank" rel="noopener"><code>Git</code></a> <code>clone</code> <a href="https://github.com/tensorflow/tensorflow" target="_blank" rel="noopener">TensorFlow 的源码</a><br>(<code>git</code> 已经由 MSYS2 安装了)</p>
</blockquote>
<!-- 
<pre class="devsite-click-to-copy">
<code class="devsite-terminal tfo-terminal-windows">git clone https://github.com/tensorflow/tensorflow.git</code>
<code class="devsite-terminal tfo-terminal-windows">cd tensorflow</code>
</pre> 
-->
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/tensorflow/tensorflow.git</span><br><span class="line"><span class="built_in">cd</span> tensorflow</span><br></pre></td></tr></table></figure>
<!-- 
The repo defaults to the `master` development branch. You can also checkout a
[release branch](https://github.com/tensorflow/tensorflow/releases){:.external}
to build:

<pre class="devsite-terminal tfo-terminal-windows prettyprint lang-bsh">
git checkout <em>branch_name</em>  # r1.9, r1.10, etc.
</pre>

Key Point: If you're having build problems on the latest development branch, try
a release branch that is known to work. 
-->
<blockquote>
<p>clone 下来的 repo 默认在 master 分支上。你可以选一个合适的 <a href="https://github.com/tensorflow/tensorflow/releases" target="_blank" rel="noopener">release 分支</a>用于构建：</p>
<pre> git checkout <em>branch_name</em>  # r1.9, r1.10, etc. </pre>

<p>关键点！如果你在最新的主分支上构建出错了，你可以尝试一下通过测试的 release 分支。</p>
</blockquote>
<!-- ## Configure the build -->
<h2 id="构建配置"><a href="#构建配置" class="headerlink" title="构建配置"></a>构建配置</h2><p>Configure your system build by running the following at the root of your<br>TensorFlow source tree:</p>
<pre class="devsite-terminal tfo-terminal-windows devsite-click-to-copy">
python ./configure.py
</pre>
>

This script prompts you for the location of TensorFlow dependencies and asks for
additional build configuration options (compiler flags, for example). The
following shows a sample run of `python ./configure.py` (your session may differ):


<figure class="highlight python"><figcaption><span>sample configuration session</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">PS C:\tf-tools\tensorflow<span class="number">-1.12</span><span class="number">.0</span>&gt; python ./configure.py</span><br><span class="line">WARNING: The following rc files are no longer being read, please transfer their contents <span class="keyword">or</span> <span class="keyword">import</span> their path into one of the standard rc files:</span><br><span class="line">c:\tf-tools\tensorflow<span class="number">-1.12</span><span class="number">.0</span>/tools/bazel.rc</span><br><span class="line">nul</span><br><span class="line">WARNING: --batch mode <span class="keyword">is</span> deprecated. Please instead explicitly shut down your Bazel server using the command <span class="string">"bazel shutdown"</span>.</span><br><span class="line">INFO: Invocation ID: <span class="number">553</span>ffb69<span class="number">-817</span>b<span class="number">-4</span>b6f-b0f9-b76a5937c4a3</span><br><span class="line">You have bazel <span class="number">0.21</span><span class="number">.0</span> installed.</span><br><span class="line">Please specify the location of python. [Default <span class="keyword">is</span> C:\Users\woclass\AppData\Local\Programs\Python\Python36\python.exe]:</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Found possible Python library paths:</span><br><span class="line">  C:\Users\woclass\AppData\Local\Programs\Python\Python36\lib\site-packages</span><br><span class="line">Please input the desired Python library path to use.  Default <span class="keyword">is</span> [C:\Users\woclass\AppData\Local\Programs\Python\Python36\lib\site-packages]</span><br><span class="line"></span><br><span class="line">Do you wish to build TensorFlow with Apache Ignite support? [Y/n]: n</span><br><span class="line">No Apache Ignite support will be enabled <span class="keyword">for</span> TensorFlow.</span><br><span class="line"></span><br><span class="line">Do you wish to build TensorFlow with XLA JIT support? [y/N]: y</span><br><span class="line">XLA JIT support will be enabled <span class="keyword">for</span> TensorFlow.</span><br><span class="line"></span><br><span class="line">Do you wish to build TensorFlow with ROCm support? [y/N]: N</span><br><span class="line">No ROCm support will be enabled <span class="keyword">for</span> TensorFlow.</span><br><span class="line"></span><br><span class="line">Do you wish to build TensorFlow with CUDA support? [y/N]: y</span><br><span class="line">CUDA support will be enabled <span class="keyword">for</span> TensorFlow.</span><br><span class="line"></span><br><span class="line">Please specify the CUDA SDK version you want to use. [Leave empty to default to CUDA <span class="number">9.0</span>]: <span class="number">9.2</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Please specify the location where CUDA <span class="number">9.2</span> toolkit <span class="keyword">is</span> installed. Refer to README.md <span class="keyword">for</span> more details. [Default <span class="keyword">is</span> C:/Program Files/NVIDIA GPU Computing Toolkit/CUDA/v9<span class="number">.2</span>]:</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Please specify the cuDNN version you want to use. [Leave empty to default to cuDNN <span class="number">7</span>]: <span class="number">7.4</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Please specify the location where cuDNN <span class="number">7</span> library <span class="keyword">is</span> installed. Refer to README.md <span class="keyword">for</span> more details. [Default <span class="keyword">is</span> C:/Program Files/NVIDIA GPU Computing Toolkit/CUDA/v9<span class="number">.2</span>]: C:/tf-tools/cuda/</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Please specify a list of comma-separated Cuda compute capabilities you want to build <span class="keyword">with</span>.</span><br><span class="line">You can find the compute capability of your device at: https://developer.nvidia.com/cuda-gpus.</span><br><span class="line">Please note that each additional compute capability significantly increases your build time <span class="keyword">and</span> binary size. [Default <span class="keyword">is</span>: <span class="number">3.5</span>,<span class="number">7.0</span>]: <span class="number">6.1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Please specify optimization flags to use during compilation when bazel option <span class="string">"--config=opt"</span> <span class="keyword">is</span> specified [Default <span class="keyword">is</span> /arch:AVX]: -march=native</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Would you like to override eigen strong inline for some C++ compilation to reduce the compilation time? [Y/n]: Y</span><br><span class="line">Eigen strong inline overridden.</span><br><span class="line"></span><br><span class="line">PS C:\tf-tools\tensorflow<span class="number">-1.12</span><span class="number">.0</span>&gt;</span><br></pre></td></tr></table></figure>

各个选项解释

1. 

关于 optimization flags 请参见：
tf 官网讲的不清楚。
- [x86 - How to compile Tensorflow with SSE4.2 and AVX instructions? - Stack Overflow](https://stackoverflow.com/questions/41293077/how-to-compile-tensorflow-with-sse4-2-and-avx-instructions)



### Configuration options

<!-- 
For [GPU support](./gpu.md), specify the versions of CUDA and cuDNN. If your
system has multiple versions of CUDA or cuDNN installed, explicitly set the
version instead of relying on the default. `./configure.py` creates symbolic links
to your system's CUDA libraries—so if you update your CUDA library paths, this
configuration step must be run again before building.

Note: Starting with TensorFlow 1.6, binaries use AVX instructions which may not
run on older CPUs. 
-->
> 对于 [支持 GPU](./gpu.md)，请在配置时指明 CUDA 和 cuDNN 的版本。
> 如果你的系统中安装了多个版本的 CUDA 或 cuDNN，请显式的设置版本，而不是使用默认值。
> `./configure.py` 会创建一个到你系统中 CUDA 库的符号链接。——所以如果你更新了 CUDA 的路径，
> 在构建之前，这个配置步骤就必须重新来过。
> 
> 注意！从 TensorFlow 1.6 开始，编译出的二进制文件使用了一些老 CPU 不支持的 AVX 指令集。


<!-- ## Build the pip package -->
## 构建 pip 包

<!-- ### Bazel build -->
### Bazel 构建

<!-- #### CPU-only -->
#### 仅支持 CPU

<!-- 
Use `bazel` to make the TensorFlow package builder with CPU-only support:

<pre class="devsite-terminal tfo-terminal-windows devsite-click-to-copy">
bazel build --config=opt //tensorflow/tools/pip_package:build_pip_package
</pre> 
-->
> 使用 `bazel` 构建 TensorFlow 包且只支持 CPU：
> 
> <pre> bazel build --config=opt //tensorflow/tools/pip_package:build_pip_package </pre>

<!-- #### GPU support -->
<h4 id="带-GPU-支持"><a href="#带-GPU-支持" class="headerlink" title="带 GPU 支持"></a>带 GPU 支持</h4><!-- 
To make the TensorFlow package builder with GPU support:

<pre class="devsite-terminal tfo-terminal-windows devsite-click-to-copy">
bazel build --config=opt --config=cuda //tensorflow/tools/pip_package:build_pip_package
</pre> 
-->
<blockquote>
<p>构建 TensorFlow 包并支持 GPU：</p>
<pre> bazel build --config=opt --config=cuda //tensorflow/tools/pip_package:build_pip_package </pre>
</blockquote>
<p>可能的报错：</p>
<ol>
<li><code>ERROR: Config value cuda is not defined in any .rc file</code></li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">PS C:\tf-tools\tensorflow-1.12.0&gt; bazel build --config=opt --config=cuda --define=no_tensorflow_py_deps=true //tensorflow/tools/pip_package:build_pip_package</span><br><span class="line">WARNING: The following rc files are no longer being read, please transfer their contents or import their path into one of the standard rc files:</span><br><span class="line">c:\tf-tools\tensorflow-1.12.0/.bazelrc</span><br><span class="line">c:\tf-tools\tensorflow-1.12.0/tools/bazel.rc</span><br><span class="line">Starting local Bazel server and connecting to it...</span><br><span class="line">INFO: Options provided by the client:</span><br><span class="line">  Inherited &apos;common&apos; options: --isatty=1 --terminal_columns=218</span><br><span class="line">INFO: Options provided by the client:</span><br><span class="line">  &apos;build&apos; options: --python_path=C:/Users/woclass/AppData/Local/Programs/Python/Python36/python.exe</span><br><span class="line">INFO: Reading rc options for &apos;build&apos; from c:\tf-tools\tensorflow-1.12.0\.tf_configure.bazelrc:</span><br><span class="line">  &apos;build&apos; options: --action_env PYTHON_BIN_PATH=C:/Users/woclass/AppData/Local/Programs/Python/Python36/python.exe --action_env PYTHON_LIB_PATH=C:/Users/woclass/AppData/Local/Programs/Python/Python36/lib/site-packaData/Local/Programs/Python/Python36/lib/site-packages --python_path=C:/Users/woclass/AppData/Local/Programs/Python/Python36/python.exe --define with_xla_support=true acEED_ROCM=0 --action_env TF_NEED_CUDA=1 --action_--action_env TF_NEED_OPENCL_SYCL=0 --action_env TF_NEED_ROCM=0 --action_env TF_NEED_CUDA=1 --action_env CUDA_TOOLKIT_PATH=C:/Program Files/NVIDIA GPU Computing Toolkit//vnv TF_CUDNN_VERSION=7 --action_env TF_CUDA_COMPUCUDA/v9.2 --action_env TF_CUDA_VERSION=9.2 --action_env CUDNN_INSTALL_PATH=C:/tf-tools/cuda --action_env TF_CUDNN_VERSION=7 --action_env TF_CUDA_COMPUTE_CAPABILITIES=6.tiimental_shortened_obj_file_path=true --define=no1 --action_env TF_CUDA_CLANG=0 --config=cuda --config monolithic --copt=-w --host_copt=-w --verbose_failures --distinct_host_configuration=false --experimental_shorteneled_obj_file_path=true --define=no_tensorflow_py_deps=true --define=override_eigen_strong_inline=true</span><br><span class="line">ERROR: Config value cuda is not defined in any .rc file</span><br><span class="line">INFO: Invocation ID: cf33d918-f992-4fce-bc5b-1956426dbaa7</span><br><span class="line">PS C:\tf-tools\tensorflow-1.12.0&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li><a href="https://github.com/tensorflow/tensorflow/issues/23401" target="_blank" rel="noopener">Build from source -&gt; build the pip package -&gt; GPU support -&gt; bazel build -&gt; ERROR: Config value cuda is not defined in any .rc file · Issue #23401 · tensorflow/tensorflow</a><br>按照说明复制 rc 文件就好</li>
</ul>
<ol start="2">
<li><a href="https://stackoverflow.com/questions/52041661/geting-error-config-value-cuda-is-not-defined-in-any-rc-file-when-trying-to-tr" target="_blank" rel="noopener">deep learning - Geting ERROR: Config value cuda is not defined in any .rc file when trying to train mobilenet in tensorflow - Stack Overflow</a><br>出这个错式用错 bazel 版本了，现在 tf 只支持 bazel 0.15</li>
</ol>
<ol start="3">
<li>又报错了，<del>可能是依赖没装好</del> 装完全部的 python 依赖依旧同样报错<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">PS C:\tf-tools\tensorflow-1.12.0&gt; bazel build --config=opt --config=cuda --define=no_tensorflow_py_deps=true //tensorflow/tools/pip_package:build_pip_package</span><br><span class="line">WARNING: The following configs were expanded more than once: [cuda]. For repeatable flags, repeats are counted twice and may lead to unexpected behavior.</span><br><span class="line">DEBUG: C:/users/woclass/_bazel_woclass/5rstnx6i/external/bazel_tools/tools/cpp/lib_cc_configure.bzl:115:5:</span><br><span class="line">Auto-Configuration Warning: &apos;BAZEL_VC&apos; is not set, start looking for the latest Visual C++ installed.</span><br><span class="line">DEBUG: C:/users/woclass/_bazel_woclass/5rstnx6i/external/bazel_tools/tools/cpp/lib_cc_configure.bzl:115:5:</span><br><span class="line">Auto-Configuration Warning: Looking for VS%VERSION%COMNTOOLS environment variables, eg. VS140COMNTOOLS</span><br><span class="line">DEBUG: C:/users/woclass/_bazel_woclass/5rstnx6i/external/bazel_tools/tools/cpp/lib_cc_configure.bzl:115:5:</span><br><span class="line">Auto-Configuration Warning: Visual C++ build tools found at C:\Program Files (x86)\Microsoft Visual Studio 14.0\VC\</span><br><span class="line">DEBUG: C:/users/woclass/_bazel_woclass/5rstnx6i/external/bazel_tools/tools/cpp/lib_cc_configure.bzl:115:5:</span><br><span class="line">Auto-Configuration Warning: &apos;BAZEL_VC&apos; is not set, start looking for the latest Visual C++ installed.</span><br><span class="line">DEBUG: C:/users/woclass/_bazel_woclass/5rstnx6i/external/bazel_tools/tools/cpp/lib_cc_configure.bzl:115:5:</span><br><span class="line">Auto-Configuration Warning: Looking for VS%VERSION%COMNTOOLS environment variables, eg. VS140COMNTOOLS</span><br><span class="line">DEBUG: C:/users/woclass/_bazel_woclass/5rstnx6i/external/bazel_tools/tools/cpp/lib_cc_configure.bzl:115:5:</span><br><span class="line">Auto-Configuration Warning: Visual C++ build tools found at C:\Program Files (x86)\Microsoft Visual Studio 14.0\VC\</span><br><span class="line">DEBUG: C:/users/woclass/_bazel_woclass/5rstnx6i/external/bazel_tools/tools/cpp/lib_cc_configure.bzl:115:5:</span><br><span class="line">Auto-Configuration Warning: &apos;BAZEL_VC&apos; is not set, start looking for the latest Visual C++ installed.</span><br><span class="line">DEBUG: C:/users/woclass/_bazel_woclass/5rstnx6i/external/bazel_tools/tools/cpp/lib_cc_configure.bzl:115:5:</span><br><span class="line">Auto-Configuration Warning: Looking for VS%VERSION%COMNTOOLS environment variables, eg. VS140COMNTOOLS</span><br><span class="line">DEBUG: C:/users/woclass/_bazel_woclass/5rstnx6i/external/bazel_tools/tools/cpp/lib_cc_configure.bzl:115:5:</span><br><span class="line">Auto-Configuration Warning: Visual C++ build tools found at C:\Program Files (x86)\Microsoft Visual Studio 14.0\VC\</span><br><span class="line">ERROR: C:/tf-tools/tensorflow-1.12.0/tensorflow/core/BUILD:644:1: no such package &apos;@com_google_absl//absl/types&apos;: java.io.IOException: thread interrupted and referenced</span><br><span class="line">by &apos;//tensorflow/core:lib&apos;</span><br><span class="line">ERROR: Analysis of target &apos;//tensorflow/tools/pip_package:build_pip_package&apos; failed; build aborted: no such package &apos;@com_google_absl//absl/types&apos;: java.io.IOException:</span><br><span class="line">thread interrupted</span><br><span class="line">INFO: Elapsed time: 307.235s</span><br><span class="line">INFO: 0 processes.</span><br><span class="line">FAILED: Build did NOT complete successfully (164 packages loaded)</span><br></pre></td></tr></table></figure>
</li>
</ol>
<ul>
<li><a href="https://blog.csdn.net/XCCCCZ/article/details/82952927" target="_blank" rel="noopener">我的AI之路(23)–在Windows下编译Bazel和使用Bazel编译tensorflow - XCCCCZ的博客 - CSDN博客</a></li>
</ul>
<p><del>参照其中的删掉缓存</del> 不存在的，没找到缓存，看上去式网络问题</p>
<ol start="4">
<li>这次换了个包报错<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">PS C:\tf-tools\tensorflow-1.12.0&gt; bazel build --config=opt --config=cuda --define=no_tensorflow_py_deps=true //tensorflow/tools/pip_package:build_pip_package</span><br><span class="line">Starting local Bazel server and connecting to it...</span><br><span class="line">...........</span><br><span class="line">WARNING: The following configs were expanded more than once: [cuda]. For repeatable flags, repeats are counted twice and may lead to unexpected behavior.</span><br><span class="line">ERROR: C:/tf-tools/tensorflow-1.12.0/tensorflow/BUILD:353:1: no such package &apos;@grpc//&apos;: java.io.IOException: thread interrupted and referenced by &apos;//tensorflow:grpc++&apos;</span><br><span class="line">ERROR: Analysis of target &apos;//tensorflow/tools/pip_package:build_pip_package&apos; failed; build aborted: Analysis failed</span><br><span class="line">INFO: Elapsed time: 396.676s</span><br><span class="line">INFO: 0 processes.</span><br><span class="line">FAILED: Build did NOT complete successfully (175 packages loaded)</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>估计还是网不好，重试 x2</p>
<p>继续重试 x3</p>
<!-- #### Bazel build options -->
<h4 id="Bazel-构建选项"><a href="#Bazel-构建选项" class="headerlink" title="Bazel 构建选项"></a>Bazel 构建选项</h4><!-- 
Building TensorFlow from source can use a lot of RAM. If your system is
memory-constrained, limit Bazel's RAM usage with: `--local_resources 2048,.5,1.0`.

If building with GPU support, add `--copt=-nvcc_options=disable-warnings`
to suppress nvcc warning messages. 
-->
<blockquote>
<p>从源码开始构建 Tensorflow 会占用很多内存。<br>如果你的系统内存有限，请限制 Bazel 的内存使用：<code>--local_resources 2048,.5,1.0</code></p>
<p>如果构建带 GPU 支持的库，请加上 <code>--copt=-nvcc_options=disable-warnings</code> 以消除 nvcc 的警告。</p>
</blockquote>
<!-- ### Build the package -->
<h3 id="构建包"><a href="#构建包" class="headerlink" title="构建包"></a>构建包</h3><!-- 
The `bazel build` command creates an executable named `build_pip_package`—this
is the program that builds the `pip` package. For example, the following builds a
`.whl` package in the `C:/tmp/tensorflow_pkg` directory:

<pre class="devsite-terminal tfo-terminal-windows devsite-click-to-copy">
bazel-bin\tensorflow\tools\pip_package\build_pip_package C:/tmp/tensorflow_pkg
</pre> 
-->
<blockquote>
<p><code>bazel build</code> 命令会创建一个叫 <code>build_pip_package</code> 的可执行文件，<br>这个程序会构建 <code>pip</code> 包。例如，一下命令会构建一个 <code>.whl</code> 包，<br>并放在 <code>C:/tmp/tensorflow_pkg</code> 目录下：</p>
<pre> bazel-bin\tensorflow\tools\pip_package\build_pip_package C:/tmp/tensorflow_pkg </pre>
</blockquote>
<!-- 
Although it is possible to build both CUDA and non-CUDA configs under the
same source tree, we recommend running `bazel clean` when switching between
these two configurations in the same source tree. 
-->
<blockquote>
<p>最然可以基于同一颗代码树构建支持 CUDA 与 不支持 CUDA 的配置文件，<br>我们还是推荐：在同一颗代码树上，每当你要切换不同的配置文件时，最好执行 <code>bazel clean</code>。</p>
</blockquote>
<!-- ### Install the package -->
<h3 id="安装包"><a href="#安装包" class="headerlink" title="安装包"></a>安装包</h3><!-- 
The filename of the generated `.whl` file depends on the TensorFlow version and
your platform. Use `pip3 install` to install the package, for example:

<pre class="devsite-terminal tfo-terminal-windows prettyprint lang-bsh">
pip3 install C:/tmp/tensorflow_pkg/tensorflow-<var>version</var>-cp36-cp36m-win_amd64.whl
</pre>

Success: TensorFlow is now installed. 
-->
<blockquote>
<p>生成的 <code>.whl</code> 文件名取决于你的 TensorFlow 的版本和你的平台类型。<br>执行 <code>pip3 install</code> 安装构完的包。例如：</p>
<pre> pip3 install C:/tmp/tensorflow_pkg/tensorflow-<var>version</var>-cp36-cp36m-win_amd64.whl </pre>

<p>等包安装完成，Tensorflow 也就成功安装了！</p>
</blockquote>
<!-- ## Build using the MSYS shell -->
<h2 id="使用-MSYS-shell-构建包"><a href="#使用-MSYS-shell-构建包" class="headerlink" title="使用 MSYS shell 构建包"></a>使用 MSYS shell 构建包</h2><p>TensorFlow can also be built using the MSYS shell. Make the changes listed<br>below, then follow the previous instructions for the Windows native command line<br>(<code>cmd.exe</code>).</p>
<h3 id="Disable-MSYS-path-conversion-hide-from-toc"><a href="#Disable-MSYS-path-conversion-hide-from-toc" class="headerlink" title="Disable MSYS path conversion {:.hide-from-toc}"></a>Disable MSYS path conversion {:.hide-from-toc}</h3><p>MSYS automatically converts arguments that look like Unix paths to Windows paths,<br>and this doesn’t work with <code>bazel</code>. (The label <code>//foo/bar:bin</code> is considered a<br>Unix absolute path since it starts with a slash.)</p>
<pre class="prettyprint lang-bsh">
<code class="devsite-terminal">export MSYS_NO_PATHCONV=1</code>
<code class="devsite-terminal">export MSYS2_ARG_CONV_EXCL="*"</code>
</pre>

<h3 id="Set-your-PATH-hide-from-toc"><a href="#Set-your-PATH-hide-from-toc" class="headerlink" title="Set your PATH {:.hide-from-toc}"></a>Set your PATH {:.hide-from-toc}</h3><p>Add the Bazel and Python installation directories to your <code>$PATH</code> environmental<br>variable. If Bazel is installed to <code>C:\tools\bazel.exe</code>, and Python to<br><code>C:\Python36\python.exe</code>, set your <code>PATH</code> with:</p>
<pre class="prettyprint lang-bsh">
# Use Unix-style with ':' as separator
<code class="devsite-terminal">export PATH="/c/tools:$PATH"</code>
<code class="devsite-terminal">export PATH="/c/Python36:$PATH"</code>
</pre>

<p>For GPU support, add the CUDA and cuDNN bin directories to your <code>$PATH</code>:</p>
<pre class="prettyprint lang-bsh">
<code class="devsite-terminal">export PATH="/c/Program Files/NVIDIA GPU Computing Toolkit/CUDA/v9.0/bin:$PATH"</code>
<code class="devsite-terminal">export PATH="/c/Program Files/NVIDIA GPU Computing Toolkit/CUDA/v9.0/extras/CUPTI/libx64:$PATH"</code>
<code class="devsite-terminal">export PATH="/c/tools/cuda/bin:$PATH"</code>
</pre>


<!-- ## Tested build configurations -->
<h2 id="经过测试的构建配置"><a href="#经过测试的构建配置" class="headerlink" title="经过测试的构建配置"></a>经过测试的构建配置</h2><h3 id="CPU"><a href="#CPU" class="headerlink" title="CPU"></a>CPU</h3><table><br><tr><th>Version</th><th>Python version</th><th>Compiler</th><th>Build tools</th></tr><br><tr><td>tensorflow-1.11.0</td><td>3.5-3.6</td><td>MSVC 2015 update 3</td><td>Cmake v3.6.3</td></tr><br><tr><td>tensorflow-1.10.0</td><td>3.5-3.6</td><td>MSVC 2015 update 3</td><td>Cmake v3.6.3</td></tr><br><tr><td>tensorflow-1.9.0</td><td>3.5-3.6</td><td>MSVC 2015 update 3</td><td>Cmake v3.6.3</td></tr><br><tr><td>tensorflow-1.8.0</td><td>3.5-3.6</td><td>MSVC 2015 update 3</td><td>Cmake v3.6.3</td></tr><br><tr><td>tensorflow-1.7.0</td><td>3.5-3.6</td><td>MSVC 2015 update 3</td><td>Cmake v3.6.3</td></tr><br><tr><td>tensorflow-1.6.0</td><td>3.5-3.6</td><td>MSVC 2015 update 3</td><td>Cmake v3.6.3</td></tr><br><tr><td>tensorflow-1.5.0</td><td>3.5-3.6</td><td>MSVC 2015 update 3</td><td>Cmake v3.6.3</td></tr><br><tr><td>tensorflow-1.4.0</td><td>3.5-3.6</td><td>MSVC 2015 update 3</td><td>Cmake v3.6.3</td></tr><br><tr><td>tensorflow-1.3.0</td><td>3.5-3.6</td><td>MSVC 2015 update 3</td><td>Cmake v3.6.3</td></tr><br><tr><td>tensorflow-1.2.0</td><td>3.5-3.6</td><td>MSVC 2015 update 3</td><td>Cmake v3.6.3</td></tr><br><tr><td>tensorflow-1.1.0</td><td>3.5</td><td>MSVC 2015 update 3</td><td>Cmake v3.6.3</td></tr><br><tr><td>tensorflow-1.0.0</td><td>3.5</td><td>MSVC 2015 update 3</td><td>Cmake v3.6.3</td></tr><br></table>

<h3 id="GPU"><a href="#GPU" class="headerlink" title="GPU"></a>GPU</h3><table><br><tr><th>Version</th><th>Python version</th><th>Compiler</th><th>Build tools</th><th>cuDNN</th><th>CUDA</th></tr><br><tr><td>tensorflow_gpu-1.11.0</td><td>3.5-3.6</td><td>MSVC 2015 update 3</td><td>Bazel 0.15.0</td><td>7</td><td>9</td></tr><br><tr><td>tensorflow_gpu-1.10.0</td><td>3.5-3.6</td><td>MSVC 2015 update 3</td><td>Cmake v3.6.3</td><td>7</td><td>9</td></tr><br><tr><td>tensorflow_gpu-1.9.0</td><td>3.5-3.6</td><td>MSVC 2015 update 3</td><td>Cmake v3.6.3</td><td>7</td><td>9</td></tr><br><tr><td>tensorflow_gpu-1.8.0</td><td>3.5-3.6</td><td>MSVC 2015 update 3</td><td>Cmake v3.6.3</td><td>7</td><td>9</td></tr><br><tr><td>tensorflow_gpu-1.7.0</td><td>3.5-3.6</td><td>MSVC 2015 update 3</td><td>Cmake v3.6.3</td><td>7</td><td>9</td></tr><br><tr><td>tensorflow_gpu-1.6.0</td><td>3.5-3.6</td><td>MSVC 2015 update 3</td><td>Cmake v3.6.3</td><td>7</td><td>9</td></tr><br><tr><td>tensorflow_gpu-1.5.0</td><td>3.5-3.6</td><td>MSVC 2015 update 3</td><td>Cmake v3.6.3</td><td>7</td><td>9</td></tr><br><tr><td>tensorflow_gpu-1.4.0</td><td>3.5-3.6</td><td>MSVC 2015 update 3</td><td>Cmake v3.6.3</td><td>6</td><td>8</td></tr><br><tr><td>tensorflow_gpu-1.3.0</td><td>3.5-3.6</td><td>MSVC 2015 update 3</td><td>Cmake v3.6.3</td><td>6</td><td>8</td></tr><br><tr><td>tensorflow_gpu-1.2.0</td><td>3.5-3.6</td><td>MSVC 2015 update 3</td><td>Cmake v3.6.3</td><td>5.1</td><td>8</td></tr><br><tr><td>tensorflow_gpu-1.1.0</td><td>3.5</td><td>MSVC 2015 update 3</td><td>Cmake v3.6.3</td><td>5.1</td><td>8</td></tr><br><tr><td>tensorflow_gpu-1.0.0</td><td>3.5</td><td>MSVC 2015 update 3</td><td>Cmake v3.6.3</td><td>5.1</td><td>8</td></tr><br></table>




<hr>
<p><strong>【官方文档-end】</strong></p>
<div style="display: none;"><br>


{% blockquote [author[, source]] [link] [source_link_title] %}
content
{% endblockquote %}


{% codeblock [title] [lang:language] [url] [link text] %}
code snippet
{% endcodeblock %}

undefined

{% img [class names] /path/to/image [width] [height] [title text [alt text]] %}

{% asset_img slug [title] %}


<br></div>

      
    </div>

    
      
      



      
      
    

    
      <footer class="post-footer">
        
        
        
  <nav class="post-nav">
    
    
      <a class="next" href="/pyplot-原点相交的坐标轴与箭头/">
        <span class="next-text nav-default">pyplot 原点相交的坐标轴与箭头</span>
        <span class="prev-text nav-mobile">下一篇</span>
        <i class="iconfont icon-right"></i>
      </a>
    
  </nav>

      </footer>
    

  </article>


          </div>
          
  <div class="comments" id="comments">
    
  </div>


        </div>  
      </main>

      <footer id="footer" class="footer">

  <div class="social-links">
    
      
    
      
    
      
    
      
        
          <a href="https://github.com/inkydragon" class="iconfont icon-github" title="github"></a>
        
      
    
      
    
      
    
    
    
      <a href="/atom.xml" class="iconfont icon-rss" title="rss"></a>
    
  </div>


<div class="copyright">
  <span class="power-by">
    由 <a class="hexo-link" href="https://hexo.io/">Hexo</a> 强力驱动
  </span>
  
  <span class="theme-info">
    主题 - 
    <a class="theme-link" href="https://github.com/ahonn/hexo-theme-even">Even</a>
  </span>

  <span class="copyright-year">
    
    &copy; 
     
      2015 - 
    
    2018

    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">woclass</span>
  </span>
</div>
      </footer>

      <div class="back-to-top" id="back-to-top">
        <i class="iconfont icon-up"></i>
      </div>
    </div>

    
  

  
  




    
  





  
    <script type="text/javascript" src="/lib/jquery/jquery-3.1.1.min.js"></script>
  

  
    <script type="text/javascript" src="/lib/slideout/slideout.js"></script>
  

  
    <script type="text/javascript" src="/lib/fancybox/jquery.fancybox.pack.js"></script>
  


    <script type="text/javascript" src="/js/src/even.js?v=2.4.x"></script>
<script type="text/javascript" src="/js/src/bootstrap.js?v=2.4.x"></script>

    
  <script type="text/html" id="search-result">
    <article class="post">
      <header class="post-header">
        <h1 class="post-title">
          <a href="$url$" class="post-link">
            $title$
          </a>
        </h1>
      </header>
      <div class="post-content">
        $content$
        <div class="read-more">
          <a href="$url$" class="read-more-link">
            阅读更多
          </a>
        </div>
      </div>
    </article>
  </script>
  <script type="text/html" id="no-search-result">
    <div class="no-result">
      <h2>No result found!</h2>
    </div>
  </script>
  <script type="text/javascript" src="/js/src/search.js?v=2.4.x"></script>

  </body>
</html>
